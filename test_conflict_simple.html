<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡åŒ–è¡çªæª¢æ¸¬æ¸¬è©¦ - PythonLearn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .log-area {
            background: #000;
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-connected { background-color: #28a745; }
        .status-disconnected { background-color: #dc3545; }
        .status-warning { background-color: #ffc107; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">ğŸ§ª ç°¡åŒ–è¡çªæª¢æ¸¬æ¸¬è©¦</h1>
        
        <!-- æ¸¬è©¦èªªæ˜ -->
        <div class="test-section">
            <h3>ğŸ“‹ æ¸¬è©¦ç›®æ¨™</h3>
            <ul>
                <li><strong>ç”¨æˆ¶åç¨±å”¯ä¸€æ€§</strong>ï¼šç¢ºä¿åŒä¸€æˆ¿é–“å…§ç”¨æˆ¶åç¨±ä¸é‡è¤‡</li>
                <li><strong>è¡çªæª¢æ¸¬é‚è¼¯</strong>ï¼šåŸºæ–¼ç”¨æˆ¶åç¨±çš„ç°¡åŒ–è¡çªæª¢æ¸¬</li>
                <li><strong>é‡è¤‡åç¨±è™•ç†</strong>ï¼šç•¶ç”¨æˆ¶åç¨±é‡è¤‡æ™‚é¡¯ç¤ºéŒ¯èª¤æç¤º</li>
            </ul>
        </div>

        <!-- æ¸¬è©¦æ­¥é©Ÿ -->
        <div class="test-section">
            <h3>ğŸ”¬ æ¸¬è©¦æ­¥é©Ÿ</h3>
            <ol>
                <li>é»æ“Šã€ŒğŸš€ æ‰“é–‹æ¸¬è©¦çª—å£ã€é–‹å•Ÿå…©å€‹æ¸¬è©¦çª—å£</li>
                <li>åœ¨å…©å€‹çª—å£ä¸­ä½¿ç”¨<strong>ç›¸åŒçš„ç”¨æˆ¶åç¨±</strong>åŠ å…¥åŒä¸€æˆ¿é–“</li>
                <li>è§€å¯Ÿç¬¬äºŒå€‹çª—å£æ˜¯å¦é¡¯ç¤ºã€Œç”¨æˆ¶åç¨±å·²è¢«ä½¿ç”¨ã€éŒ¯èª¤</li>
                <li>ä¿®æ”¹ç¬¬äºŒå€‹çª—å£çš„ç”¨æˆ¶åç¨±ï¼ŒæˆåŠŸåŠ å…¥æˆ¿é–“</li>
                <li>åœ¨ä¸€å€‹çª—å£ä¸­ç·¨è¼¯ä»£ç¢¼ï¼Œè§€å¯Ÿå¦ä¸€å€‹çª—å£æ˜¯å¦è§¸ç™¼è¡çªæª¢æ¸¬</li>
            </ol>
        </div>

        <!-- æ¸¬è©¦æ§åˆ¶ -->
        <div class="test-section">
            <h3>ğŸ® æ¸¬è©¦æ§åˆ¶</h3>
            <div class="row">
                <div class="col-md-6">
                    <button id="openTestWindows" class="btn btn-primary btn-lg w-100 mb-3">
                        ğŸš€ æ‰“é–‹æ¸¬è©¦çª—å£
                    </button>
                    <button id="clearLogs" class="btn btn-secondary w-100">
                        ğŸ§¹ æ¸…é™¤æ—¥èªŒ
                    </button>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">é€£æ¥ç‹€æ…‹</h5>
                            <p class="card-text">
                                <span class="status-indicator status-connected"></span>
                                æœå‹™å™¨é‹è¡Œåœ¨: <code>http://localhost:8080</code>
                            </p>
                            <p class="card-text">
                                <span class="status-indicator status-warning"></span>
                                æ¸¬è©¦æˆ¿é–“: <code>conflict-test</code>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¸¬è©¦æ—¥èªŒ -->
        <div class="test-section">
            <h3>ğŸ“Š æ¸¬è©¦æ—¥èªŒ</h3>
            <div id="testLogs" class="log-area">
                <div>ğŸ”§ è¡çªæª¢æ¸¬æ¸¬è©¦ç³»çµ±å·²å°±ç·’...</div>
                <div>ğŸ“¡ ç­‰å¾…æ¸¬è©¦çª—å£é€£æ¥...</div>
            </div>
        </div>

        <!-- é æœŸçµæœ -->
        <div class="test-section">
            <h3>âœ… é æœŸçµæœ</h3>
            <div class="row">
                <div class="col-md-6">
                    <h5>ğŸš« ç”¨æˆ¶åç¨±é‡è¤‡</h5>
                    <ul>
                        <li>ç¬¬äºŒå€‹çª—å£é¡¯ç¤ºéŒ¯èª¤ï¼šã€Œç”¨æˆ¶åç¨±å·²è¢«ä½¿ç”¨ã€</li>
                        <li>è‡ªå‹•è¿”å›ç™»å…¥è¡¨å–®è¦æ±‚ä¿®æ”¹åç¨±</li>
                        <li>ä¸å…è¨±é‡è¤‡åç¨±çš„ç”¨æˆ¶åŠ å…¥æˆ¿é–“</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>âš¡ è¡çªæª¢æ¸¬</h5>
                    <ul>
                        <li>ç•¶ç”¨æˆ¶æ­£åœ¨ç·¨è¼¯æ™‚ï¼Œæ”¶åˆ°å…¶ä»–ç”¨æˆ¶çš„ä»£ç¢¼è®Šæ›´</li>
                        <li>è§¸ç™¼è¡çªæª¢æ¸¬å½ˆçª—</li>
                        <li>æä¾›ã€Œè¼‰å…¥æœå‹™å™¨æœ€æ–°ç‰ˆã€ã€ã€Œå¼·åˆ¶æ›´æ–°æˆ‘çš„ç‰ˆæœ¬ã€é¸é …</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // æ¸¬è©¦æ—¥èªŒç®¡ç†
        class TestLogger {
            constructor() {
                this.logArea = document.getElementById('testLogs');
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const icons = {
                    info: 'â„¹ï¸',
                    success: 'âœ…',
                    error: 'âŒ',
                    warning: 'âš ï¸',
                    debug: 'ğŸ”'
                };
                
                const logEntry = document.createElement('div');
                logEntry.innerHTML = `[${timestamp}] ${icons[type]} ${message}`;
                this.logArea.appendChild(logEntry);
                this.logArea.scrollTop = this.logArea.scrollHeight;
            }

            clear() {
                this.logArea.innerHTML = `
                    <div>ğŸ”§ è¡çªæª¢æ¸¬æ¸¬è©¦ç³»çµ±å·²å°±ç·’...</div>
                    <div>ğŸ“¡ ç­‰å¾…æ¸¬è©¦çª—å£é€£æ¥...</div>
                `;
            }
        }

        const logger = new TestLogger();

        // æ¸¬è©¦çª—å£ç®¡ç†
        class TestWindowManager {
            constructor() {
                this.windows = [];
                this.testRoom = 'conflict-test';
                this.baseUrl = 'http://localhost:8080';
            }

            openTestWindows() {
                logger.log('æ­£åœ¨æ‰“é–‹æ¸¬è©¦çª—å£...', 'info');
                
                // é—œé–‰ç¾æœ‰çª—å£
                this.closeAllWindows();

                // æ‰“é–‹å…©å€‹æ¸¬è©¦çª—å£
                const window1 = window.open(
                    `${this.baseUrl}?room=${this.testRoom}&user=æ¸¬è©¦ç”¨æˆ¶A`,
                    'TestWindow1',
                    'width=800,height=600,left=100,top=100'
                );

                const window2 = window.open(
                    `${this.baseUrl}?room=${this.testRoom}&user=æ¸¬è©¦ç”¨æˆ¶A`, // æ•…æ„ä½¿ç”¨ç›¸åŒåç¨±
                    'TestWindow2',
                    'width=800,height=600,left=950,top=100'
                );

                if (window1) {
                    this.windows.push(window1);
                    logger.log('æ¸¬è©¦çª—å£ 1 å·²æ‰“é–‹ (ç”¨æˆ¶å: æ¸¬è©¦ç”¨æˆ¶A)', 'success');
                } else {
                    logger.log('ç„¡æ³•æ‰“é–‹æ¸¬è©¦çª—å£ 1 - è«‹æª¢æŸ¥å½ˆçª—é˜»æ“‹è¨­å®š', 'error');
                }

                if (window2) {
                    this.windows.push(window2);
                    logger.log('æ¸¬è©¦çª—å£ 2 å·²æ‰“é–‹ (ç”¨æˆ¶å: æ¸¬è©¦ç”¨æˆ¶A - æ‡‰è©²æœƒè¡çª)', 'warning');
                } else {
                    logger.log('ç„¡æ³•æ‰“é–‹æ¸¬è©¦çª—å£ 2 - è«‹æª¢æŸ¥å½ˆçª—é˜»æ“‹è¨­å®š', 'error');
                }

                // æ·»åŠ æ¸¬è©¦æŒ‡å°
                setTimeout(() => {
                    logger.log('ğŸ“‹ æ¸¬è©¦æŒ‡å°ï¼š', 'info');
                    logger.log('1. è§€å¯Ÿçª—å£2æ˜¯å¦é¡¯ç¤ºã€Œç”¨æˆ¶åç¨±å·²è¢«ä½¿ç”¨ã€éŒ¯èª¤', 'info');
                    logger.log('2. åœ¨çª—å£2ä¸­ä¿®æ”¹ç”¨æˆ¶åç¨±ç‚ºã€Œæ¸¬è©¦ç”¨æˆ¶Bã€', 'info');
                    logger.log('3. æˆåŠŸåŠ å…¥æˆ¿é–“å¾Œï¼Œåœ¨ä¸€å€‹çª—å£ä¸­ç·¨è¼¯ä»£ç¢¼', 'info');
                    logger.log('4. è§€å¯Ÿå¦ä¸€å€‹çª—å£æ˜¯å¦è§¸ç™¼è¡çªæª¢æ¸¬', 'info');
                }, 2000);
            }

            closeAllWindows() {
                this.windows.forEach(win => {
                    if (win && !win.closed) {
                        win.close();
                    }
                });
                this.windows = [];
                logger.log('å·²é—œé–‰æ‰€æœ‰æ¸¬è©¦çª—å£', 'info');
            }
        }

        const windowManager = new TestWindowManager();

        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('openTestWindows').addEventListener('click', () => {
            windowManager.openTestWindows();
        });

        document.getElementById('clearLogs').addEventListener('click', () => {
            logger.clear();
        });

        // é é¢è¼‰å…¥å®Œæˆ
        document.addEventListener('DOMContentLoaded', () => {
            logger.log('æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ', 'success');
            logger.log('æœå‹™å™¨åœ°å€: http://localhost:8080', 'info');
            logger.log('æ¸¬è©¦æˆ¿é–“: conflict-test', 'info');
            
            // æª¢æŸ¥æœå‹™å™¨é€£æ¥
            fetch('http://localhost:8080/api/status')
                .then(response => response.json())
                .then(data => {
                    logger.log(`æœå‹™å™¨ç‹€æ…‹: ${data.status}`, 'success');
                    logger.log(`åœ¨ç·šç”¨æˆ¶: ${data.stats?.onlineUsers || 0}`, 'info');
                })
                .catch(error => {
                    logger.log('ç„¡æ³•é€£æ¥åˆ°æœå‹™å™¨ï¼Œè«‹ç¢ºèªæœå‹™å™¨å·²å•Ÿå‹•', 'error');
                });
        });

        // çª—å£é—œé–‰æ™‚æ¸…ç†
        window.addEventListener('beforeunload', () => {
            windowManager.closeAllWindows();
        });
    </script>
</body>
</html> 