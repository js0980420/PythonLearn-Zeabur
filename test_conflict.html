<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡çªæª¢æ¸¬æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .test-button { margin: 5px; padding: 10px 15px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 3px; font-family: monospace; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸ” è¡çªæª¢æ¸¬æ¸¬è©¦å·¥å…·</h1>
    
    <div class="test-section">
        <h3>æ¸¬è©¦æ­¥é©Ÿ</h3>
        <ol>
            <li>æ‰“é–‹å…©å€‹ç€è¦½å™¨çª—å£ï¼Œéƒ½è¨ªå• <code>http://localhost:8080</code></li>
            <li>å…©å€‹çª—å£éƒ½åŠ å…¥åŒä¸€å€‹æˆ¿é–“ï¼ˆä¾‹å¦‚ï¼štest-roomï¼‰</li>
            <li>åœ¨ç¬¬ä¸€å€‹çª—å£é–‹å§‹ç·¨è¼¯ä»£ç¢¼ï¼ˆè§¸ç™¼ isEditing = trueï¼‰</li>
            <li>åœ¨ç¬¬äºŒå€‹çª—å£ä¹Ÿç·¨è¼¯ä¸¦ç™¼é€ä»£ç¢¼è®Šæ›´</li>
            <li>ç¬¬ä¸€å€‹çª—å£æ‡‰è©²æ”¶åˆ°è¡çªæª¢æ¸¬å½ˆçª—</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>æ¸¬è©¦å·¥å…·</h3>
        <button class="test-button" onclick="openTestWindows()">ğŸš€ æ‰“é–‹æ¸¬è©¦çª—å£</button>
        <button class="test-button" onclick="checkConflictLogic()">ğŸ” æª¢æŸ¥è¡çªé‚è¼¯</button>
        <button class="test-button" onclick="simulateConflict()">âš¡ æ¨¡æ“¬è¡çªæƒ…æ³</button>
    </div>

    <div class="test-section">
        <h3>æ¸¬è©¦æ—¥èªŒ</h3>
        <div id="testLog" class="log">ç­‰å¾…æ¸¬è©¦é–‹å§‹...</div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function openTestWindows() {
            log('ğŸš€ æ­£åœ¨æ‰“é–‹æ¸¬è©¦çª—å£...');
            
            // æ‰“é–‹ç¬¬ä¸€å€‹çª—å£
            const window1 = window.open('http://localhost:8080', 'test1', 'width=800,height=600,left=100,top=100');
            
            // å»¶é²æ‰“é–‹ç¬¬äºŒå€‹çª—å£
            setTimeout(() => {
                const window2 = window.open('http://localhost:8080', 'test2', 'width=800,height=600,left=950,top=100');
                log('âœ… å…©å€‹æ¸¬è©¦çª—å£å·²æ‰“é–‹');
                log('ğŸ“ è«‹åœ¨å…©å€‹çª—å£ä¸­éƒ½åŠ å…¥åŒä¸€å€‹æˆ¿é–“');
            }, 1000);
        }

        function checkConflictLogic() {
            log('ğŸ” æª¢æŸ¥è¡çªæª¢æ¸¬é‚è¼¯...');
            
            // æ¨¡æ“¬è¡çªæª¢æ¸¬æ¢ä»¶
            const testCases = [
                {
                    name: 'æ­£å¸¸è¡çª',
                    isEditing: true,
                    localVersion: 1,
                    remoteVersion: 2,
                    localUser: 'user1',
                    remoteUser: 'user2',
                    expected: true
                },
                {
                    name: 'åŒä¸€ç”¨æˆ¶',
                    isEditing: true,
                    localVersion: 1,
                    remoteVersion: 2,
                    localUser: 'user1',
                    remoteUser: 'user1',
                    expected: false
                },
                {
                    name: 'æœªç·¨è¼¯ç‹€æ…‹',
                    isEditing: false,
                    localVersion: 1,
                    remoteVersion: 2,
                    localUser: 'user1',
                    remoteUser: 'user2',
                    expected: false
                },
                {
                    name: 'ç‰ˆæœ¬ä¸è¡çª',
                    isEditing: true,
                    localVersion: 2,
                    remoteVersion: 1,
                    localUser: 'user1',
                    remoteUser: 'user2',
                    expected: false
                }
            ];

            testCases.forEach(testCase => {
                const condition1 = testCase.isEditing;
                const condition2 = testCase.remoteVersion > testCase.localVersion;
                const condition3 = testCase.remoteUser !== testCase.localUser;
                const result = condition1 && condition2 && condition3;
                
                const status = result === testCase.expected ? 'âœ…' : 'âŒ';
                log(`${status} ${testCase.name}: ${result} (é æœŸ: ${testCase.expected})`);
            });
        }

        function simulateConflict() {
            log('âš¡ æ¨¡æ“¬è¡çªæƒ…æ³...');
            log('ğŸ“ é€™éœ€è¦åœ¨å¯¦éš›çš„æ‡‰ç”¨ä¸­æ¸¬è©¦');
            log('ğŸ”§ è«‹æŒ‰ç…§æ¸¬è©¦æ­¥é©Ÿæ‰‹å‹•æ“ä½œ');
            
            // æä¾›è©³ç´°çš„æ¸¬è©¦æŒ‡å°
            log('');
            log('è©³ç´°æ¸¬è©¦æ­¥é©Ÿï¼š');
            log('1. çª—å£A: åŠ å…¥æˆ¿é–“ test-roomï¼Œç”¨æˆ¶å user1');
            log('2. çª—å£B: åŠ å…¥æˆ¿é–“ test-roomï¼Œç”¨æˆ¶å user2');
            log('3. çª—å£A: åœ¨ç·¨è¼¯å™¨ä¸­è¼¸å…¥ä¸€äº›ä»£ç¢¼ï¼ˆè§¸ç™¼ isEditing = trueï¼‰');
            log('4. çª—å£B: å¿«é€Ÿè¼¸å…¥ä¸åŒçš„ä»£ç¢¼ä¸¦ç­‰å¾…åŒæ­¥');
            log('5. çª—å£A: æ‡‰è©²çœ‹åˆ°è¡çªæª¢æ¸¬å½ˆçª—');
            log('');
            log('å¦‚æœæ²’æœ‰çœ‹åˆ°è¡çªå½ˆçª—ï¼Œè«‹æª¢æŸ¥ç€è¦½å™¨æ§åˆ¶å°çš„æ—¥èªŒ');
        }

        // é é¢åŠ è¼‰æ™‚çš„åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸ” è¡çªæª¢æ¸¬æ¸¬è©¦å·¥å…·å·²æº–å‚™å°±ç·’');
            log('ğŸ“‹ è«‹æŒ‰ç…§ä¸Šæ–¹çš„æ¸¬è©¦æ­¥é©Ÿé€²è¡Œæ“ä½œ');
        };
    </script>
</body>
</html> 